## KillrVideo MVP - Acceptance Test Plan

**Version:** 1.0
**Date:** May 29, 2025
**Test Environment:** Local deployment of the application (monolith or individual services accessible via defined base URL).
**Tool:** Postman (or any API testing tool)

---

### 1. Pre-requisites & Setup

1.  **Application Running:** The KillrVideo backend application (monolith or relevant microservices) must be running and accessible.
2.  **Database:** AstraDB instance should be accessible and configured. It's recommended to start with a clean or known state for some tests.
3.  **Postman Setup:**
    *   Create a Postman Collection named "KillrVideo MVP Acceptance Tests".
    *   Create a Postman Environment named "KillrVideo MVP Env" with the following variables:
        *   `baseURL`: The base URL for the API (e.g., `http://localhost:8000/api/v1`).
        *   `viewerEmail`: `viewer@example.com`
        *   `viewerPassword`: `password123`
        *   `creatorEmail`: `creator@example.com`
        *   `creatorPassword`: `password456`
        *   `moderatorEmail`: `moderator@example.com`
        *   `moderatorPassword`: `password789`
        *   `adminEmail`: `admin@example.com` (This user will be manually promoted to moderator for initial setup).
        *   `adminPassword`: `adminpass`
        *   `viewerToken`: (To be populated by login test)
        *   `creatorToken`: (To be populated by login test)
        *   `moderatorToken`: (To be populated by login test / admin user's token after promotion)
        *   `testUserIdViewer`: (To be populated by registration test)
        *   `testUserIdCreator`: (To be populated by registration test)
        *   `testUserIdModerator`: (To be populated by registration test for admin)
        *   `submittedVideoId`: (To be populated after video submission)
        *   `submittedCommentId`: (To be populated after comment submission)
        *   `submittedFlagId`: (To be populated after flag submission)
        *   `youtubeUrlGood`: `https://www.youtube.com/watch?v=known_good_id`
        *   `youtubeUrlBad`: `https://www.youtube.com/watch?v=known_bad_id` (or an invalid URL)
4.  **Initial Data Setup (Manual/Scripted before test run for some scenarios):**
    *   It's assumed that at least one user (e.g., `admin@example.com`) is registered and then manually given the "moderator" role in the database to kickstart moderator-specific tests. Alternatively, the first moderator assignment test will achieve this.
    *   For simplicity, tests will often create the data they need (e.g., register users, submit videos).

---

### 2. Test Execution Strategy

*   Tests are grouped by feature/epic.
*   Some tests depend on the successful execution of previous tests (e.g., login requires registration; actions on video require video submission).
*   Postman's scripting capabilities should be used to extract tokens and IDs from responses and store them in environment variables for use in subsequent requests.

---

### 3. Test Cases

#### Epic 1: Account Management

| Test Case ID | Feature/User Story                 | Test Scenario                                      | Preconditions                                  | Test Steps (Postman)                                                                                                                                                                                             | Expected Result                                                                                                                                                                                                      | Test Data                                                                                                                                                                     |
| :----------- | :--------------------------------- | :------------------------------------------------- | :--------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **AM-001**   | User Registration                  | Register a new "viewer" user successfully.         | None                                           | **Method:** POST <br> **URL:** `{{baseURL}}/users/register` <br> **Headers:** `Content-Type: application/json` <br> **Body:** `{ "firstName": "Test", "lastName": "Viewer", "email": "{{viewerEmail}}", "password": "{{viewerPassword}}" }` | **Status:** 201 Created <br> **Body:** JSON with `userId`, `firstName`, `lastName`, `email`. <br> *Postman Test Script: Save `userId` to `testUserIdViewer`.*                                                            | `firstName`: "Test", `lastName`: "Viewer", `email`: `viewer@example.com`, `password`: `password123`                                                                         |
| **AM-002**   | User Registration                  | Register a new "creator" user successfully.        | None                                           | **Method:** POST <br> **URL:** `{{baseURL}}/users/register` <br> **Headers:** `Content-Type: application/json` <br> **Body:** `{ "firstName": "Test", "lastName": "Creator", "email": "{{creatorEmail}}", "password": "{{creatorPassword}}" }` | **Status:** 201 Created <br> **Body:** JSON with `userId`, `firstName`, `lastName`, `email`. <br> *Postman Test Script: Save `userId` to `testUserIdCreator`.*                                                          | `firstName`: "Test", `lastName`: "Creator", `email`: `creator@example.com`, `password`: `password456`                                                                       |
| **AM-003**   | User Registration                  | Register an "admin" user (for moderator promotion). | None                                           | **Method:** POST <br> **URL:** `{{baseURL}}/users/register` <br> **Headers:** `Content-Type: application/json` <br> **Body:** `{ "firstName": "Admin", "lastName": "User", "email": "{{adminEmail}}", "password": "{{adminPassword}}" }`    | **Status:** 201 Created <br> **Body:** JSON with `userId`, `firstName`, `lastName`, `email`. <br> *Postman Test Script: Save `userId` to `testUserIdModerator`.*                                                        | `firstName`: "Admin", `lastName`: "User", `email`: `admin@example.com`, `password`: `adminpass`                                                                             |
| **AM-004**   | User Registration                  | Attempt to register with an existing email.        | AM-001 executed.                               | **Method:** POST <br> **URL:** `{{baseURL}}/users/register` <br> **Headers:** `Content-Type: application/json` <br> **Body:** `{ "firstName": "Another", "lastName": "User", "email": "{{viewerEmail}}", "password": "anotherpass" }`  | **Status:** 400 Bad Request <br> **Body:** Problem+JSON with detail "Email already registered".                                                                                                                        | `email`: `viewer@example.com` (from AM-001)                                                                                                                                   |
| **AM-005**   | User Login                         | Login with valid "viewer" credentials.             | AM-001 executed.                               | **Method:** POST <br> **URL:** `{{baseURL}}/users/login` <br> **Headers:** `Content-Type: application/json` <br> **Body:** `{ "email": "{{viewerEmail}}", "password": "{{viewerPassword}}" }`                                   | **Status:** 200 OK <br> **Body:** JSON with `token` and `user` object (including roles like `["viewer"]`). <br> *Postman Test Script: Save `token` to `viewerToken`.*                                                   | `email`: `viewer@example.com`, `password`: `password123`                                                                                                                       |
| **AM-006**   | User Login                         | Login with valid "creator" credentials.            | AM-002 executed.                               | **Method:** POST <br> **URL:** `{{baseURL}}/users/login` <br> **Headers:** `Content-Type: application/json` <br> **Body:** `{ "email": "{{creatorEmail}}", "password": "{{creatorPassword}}" }`                                 | **Status:** 200 OK <br> **Body:** JSON with `token` and `user` object (including `roles=["viewer"]` initially). <br> *Postman Test Script: Save `token` to `creatorToken`.* (Creator role assigned later via moderation test). | `email`: `creator@example.com`, `password`: `password456`                                                                                                                      |
| **AM-007**   | User Login                         | Login with "admin" credentials.                    | AM-003 executed.                               | **Method:** POST <br> **URL:** `{{baseURL}}/users/login` <br> **Headers:** `Content-Type: application/json` <br> **Body:** `{ "email": "{{adminEmail}}", "password": "{{adminPassword}}" }`                                     | **Status:** 200 OK <br> **Body:** JSON with `token` and `user` object. <br> *Postman Test Script: Save `token` to `moderatorToken` (this will be the initial moderator).*                                              | `email`: `admin@example.com`, `password`: `adminpass`                                                                                                                          |
| **AM-008**   | User Login                         | Attempt login with invalid password.               | AM-001 executed.                               | **Method:** POST <br> **URL:** `{{baseURL}}/users/login` <br> **Headers:** `Content-Type: application/json` <br> **Body:** `{ "email": "{{viewerEmail}}", "password": "wrongPassword" }`                                     | **Status:** 401 Unauthorized <br> **Body:** Problem+JSON with detail "Incorrect email or password".                                                                                                                        | `email`: `viewer@example.com`, `password`: `wrongPassword`                                                                                                                     |
| **AM-009**   | Get User Profile                   | Get current "viewer" user's profile.               | AM-005 executed (viewerToken available).       | **Method:** GET <br> **URL:** `{{baseURL}}/users/me` <br> **Headers:** `Authorization: Bearer {{viewerToken}}`                                                                                                         | **Status:** 200 OK <br> **Body:** JSON with viewer's user details (`userId`, `firstName`, `lastName`, `email`, `roles`).                                                                                                  | None                                                                                                                                                                          |
| **AM-010**   | Update User Profile                | Update current "viewer" user's profile.            | AM-005 executed.                               | **Method:** PUT <br> **URL:** `{{baseURL}}/users/me` <br> **Headers:** `Authorization: Bearer {{viewerToken}}`, `Content-Type: application/json` <br> **Body:** `{ "firstName": "UpdatedViewer", "lastName": "Name" }`        | **Status:** 200 OK <br> **Body:** JSON with updated user details. <br> *Follow-up with GET /users/me to verify.*                                                                                                              | `firstName`: "UpdatedViewer", `lastName`: "Name"                                                                                                                              |

---

#### Epic 2: Video Catalog & Interactions

*Prerequisite: For "creator" actions, the `creator@example.com` user needs the "creator" role. This will be tested as part of Epic 6 (Moderation). For now, manually update the DB for `creator@example.com` to have `["viewer", "creator"]` roles if needed for early testing, or use `adminToken` (who will be made moderator) for submission if the creator role isn't assignable yet via API.*
*Assume for test VC-001, the `adminToken` (who is a moderator and implicitly a creator) is used.*

| Test Case ID | Feature/User Story           | Test Scenario                                        | Preconditions                                                                | Test Steps (Postman)                                                                                                                                                                                             | Expected Result                                                                                                                                                                                                                               | Test Data                                                                   |
| :----------- | :--------------------------- | :--------------------------------------------------- | :--------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------- |
| **VC-001**   | Video Submission             | "Creator" submits a valid YouTube video URL.       | AM-007 executed (`moderatorToken` available, assuming moderator has creator rights). | **Method:** POST <br> **URL:** `{{baseURL}}/videos` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`, `Content-Type: application/json` <br> **Body:** `{ "youtubeUrl": "{{youtubeUrlGood}}" }`                     | **Status:** 202 Accepted <br> **Body:** JSON with video details (`videoId`, initial `title`, `status: "PENDING"`). <br> *Postman Test Script: Save `videoId` to `submittedVideoId`.*                                                            | `youtubeUrl`: `https://www.youtube.com/watch?v=known_good_id` (valid mock) |
| **VC-002**   | Video Submission             | "Viewer" attempts to submit a video URL.           | AM-005 executed (`viewerToken` available).                                 | **Method:** POST <br> **URL:** `{{baseURL}}/videos` <br> **Headers:** `Authorization: Bearer {{viewerToken}}`, `Content-Type: application/json` <br> **Body:** `{ "youtubeUrl": "{{youtubeUrlGood}}" }`                       | **Status:** 403 Forbidden <br> **Body:** Problem+JSON indicating role/permission issue.                                                                                                                                             | `youtubeUrl`: `https://www.youtube.com/watch?v=known_good_id`             |
| **VC-003**   | Video Processing Status      | Check status of a submitted video (by owner/creator). | VC-001 executed.                                                           | **Method:** GET <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/status` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`                                                                                  | **Status:** 200 OK <br> **Body:** JSON with `videoId` and `status`. Initially "PENDING". <br> *After a delay (e.g., 10s for mock processing), re-run: status should be "READY".*                                                            | Use `submittedVideoId`.                                                     |
| **VC-004**   | Get Video Details            | Any user gets details of a processed video.          | VC-001 executed and video processed to "READY".                            | **Method:** GET <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}` <br> **Headers:** None                                                                                                                        | **Status:** 200 OK <br> **Body:** JSON with full video details (title from mock YouTube, description, `status: "READY"`).                                                                                                                | Use `submittedVideoId`.                                                     |
| **VC-005**   | Record Video View            | Record a view for a video.                           | VC-004 executed.                                                           | **Method:** POST <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/view` <br> **Headers:** None                                                                                                                     | **Status:** 204 No Content. <br> *Verify (conceptually or by GET /videos/{{submittedVideoId}} again) that viewCount incremented.*                                                                                                       | Use `submittedVideoId`.                                                     |
| **VC-006**   | List Latest Videos           | Any user lists latest videos.                        | VC-001 executed.                                                           | **Method:** GET <br> **URL:** `{{baseURL}}/videos/latest?page=1&pageSize=5` <br> **Headers:** None                                                                                                                   | **Status:** 200 OK <br> **Body:** PaginatedResponse with a list of `VideoSummary` objects. `submittedVideoId` should be among them.                                                                                                | None                                                                        |
| **VC-007**   | List Videos by Tag           | Any user lists videos by a specific tag.             | VC-001 executed, and its video has tags (e.g. after update).               | **Method:** GET <br> **URL:** `{{baseURL}}/videos/by-tag/mocking?page=1&pageSize=5` <br> **Headers:** None                                                                                                            | **Status:** 200 OK <br> **Body:** PaginatedResponse with videos tagged "mocking". (Requires video to be updated with this tag first).                                                                                                 | `tag`: "mocking"                                                            |
| **VC-008**   | List Videos by Uploader      | Any user lists videos by uploader ID.                | VC-001 executed.                                                           | **Method:** GET <br> **URL:** `{{baseURL}}/videos/by-uploader/{{testUserIdModerator}}?page=1&pageSize=5` <br> **Headers:** None                                                                                           | **Status:** 200 OK <br> **Body:** PaginatedResponse with videos uploaded by `testUserIdModerator`. `submittedVideoId` should be present.                                                                                           | Use `testUserIdModerator`.                                                  |
| **VC-009**   | Update Video Details         | Owner/Moderator updates video details.               | VC-001 executed. `moderatorToken` is owner.                                | **Method:** PUT <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`, `Content-Type: application/json` <br> **Body:** `{ "title": "Updated Mock Title", "tags": ["mocking", "testing"] }` | **Status:** 200 OK <br> **Body:** JSON with updated video details. <br> *Follow-up GET to verify changes.*                                                                                                                     | `title`: "Updated Mock Title", `tags`: `["mocking", "testing"]`               |
| **VC-010**   | Get Related Videos (Stub)    | Any user gets related videos for a video.            | VC-001 executed.                                                           | **Method:** GET <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/related?limit=3` <br> **Headers:** None                                                                                                           | **Status:** 200 OK <br> **Body:** List of `RecommendationItem` objects (stubbed response). Max 3 items. Ensure `submittedVideoId` is not in the list.                                                                              | Use `submittedVideoId`.                                                     |


---
#### Epic 3: Search Functionality

| Test Case ID | Feature/User Story           | Test Scenario                                  | Preconditions                                             | Test Steps (Postman)                                                                                                                                                                                                | Expected Result                                                                                                                                                                                          | Test Data                    |
| :----------- | :--------------------------- | :--------------------------------------------- | :-------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------- |
| **SE-001**   | Keyword Search for Videos    | Search for videos using a relevant keyword.    | VC-001 (video exists with "Epic Mock Video Title").         | **Method:** GET <br> **URL:** `{{baseURL}}/search/videos?query=Epic%20Mock&page=1&pageSize=5` <br> **Headers:** None                                                                                                  | **Status:** 200 OK <br> **Body:** PaginatedResponse. `submittedVideoId` should be in the `data` list.                                                                                                         | `query`: "Epic Mock"       |
| **SE-002**   | Keyword Search for Videos    | Search for videos with no results.             | None specific, just a query unlikely to match.            | **Method:** GET <br> **URL:** `{{baseURL}}/search/videos?query=NonExistentXYZ&page=1&pageSize=5` <br> **Headers:** None                                                                                                 | **Status:** 200 OK <br> **Body:** PaginatedResponse with `data` list empty and `totalItems: 0`.                                                                                                           | `query`: "NonExistentXYZ"  |
| **SE-003**   | Tag Suggestion             | Get tag suggestions for a partial query.       | VC-009 executed (video has tag "mocking", "testing").     | **Method:** GET <br> **URL:** `{{baseURL}}/search/tags/suggest?query=mock&limit=5` <br> **Headers:** None                                                                                                            | **Status:** 200 OK <br> **Body:** List of `TagSuggestion` objects, including `{"tag": "mocking"}`.                                                                                                       | `query`: "mock"              |

---
#### Epic 4: Comments & Ratings

| Test Case ID | Feature/User Story           | Test Scenario                                              | Preconditions                                                  | Test Steps (Postman)                                                                                                                                                                                                                           | Expected Result                                                                                                                                                                                                                            | Test Data                                                                                                                                                                              |
| :----------- | :--------------------------- | :--------------------------------------------------------- | :------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **CR-001**   | Add Comment                  | Authenticated "viewer" adds a comment to a video.        | VC-001 executed (`submittedVideoId` available). AM-005 executed (`viewerToken` available). | **Method:** POST <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/comments` <br> **Headers:** `Authorization: Bearer {{viewerToken}}`, `Content-Type: application/json` <br> **Body:** `{ "text": "This is a great test comment!" }`         | **Status:** 201 Created <br> **Body:** JSON `CommentResponse` with comment details (`commentId`, `text`, `userId`, `videoId`, `sentiment` (can be null)). <br> *Postman Test Script: Save `commentId` to `submittedCommentId`.*                          | `text`: "This is a great test comment!"                                                                                                                                                |
| **CR-002**   | List Comments for Video      | Any user lists comments for a video.                       | CR-001 executed.                                               | **Method:** GET <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/comments?page=1&pageSize=10` <br> **Headers:** None                                                                                                                  | **Status:** 200 OK <br> **Body:** PaginatedResponse containing the comment from CR-001.                                                                                                                                                         | Use `submittedVideoId`.                                                                                                                                                                |
| **CR-003**   | List Comments by User        | Any user lists comments by a specific user.                | CR-001 executed.                                               | **Method:** GET <br> **URL:** `{{baseURL}}/users/{{testUserIdViewer}}/comments?page=1&pageSize=10` <br> **Headers:** None                                                                                                                | **Status:** 200 OK <br> **Body:** PaginatedResponse containing the comment from CR-001.                                                                                                                                                         | Use `testUserIdViewer`.                                                                                                                                                                |
| **CR-004**   | Rate Video                   | Authenticated "viewer" rates a video (first time).       | VC-001, AM-005 executed.                                       | **Method:** POST <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/ratings` <br> **Headers:** `Authorization: Bearer {{viewerToken}}`, `Content-Type: application/json` <br> **Body:** `{ "rating": 5 }`                             | **Status:** 200 OK (or 201 if creating) <br> **Body:** `RatingResponse` with rating details. <br> *Verify `averageRating` and `totalRatingsCount` on video are updated (conceptual, or check with GET /videos/{id}/ratings).*                      | `rating`: 5                                                                                                                                                                            |
| **CR-005**   | Update Video Rating          | Authenticated "viewer" updates their rating for a video. | CR-004 executed.                                               | **Method:** POST <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/ratings` <br> **Headers:** `Authorization: Bearer {{viewerToken}}`, `Content-Type: application/json` <br> **Body:** `{ "rating": 4 }`                             | **Status:** 200 OK <br> **Body:** `RatingResponse` with updated rating details. <br> *Verify `averageRating` and `totalRatingsCount` on video are re-calculated.*                                                                         | `rating`: 4                                                                                                                                                                            |
| **CR-006**   | Get Aggregate Rating         | Unauthenticated user gets video rating summary.            | CR-004 or CR-005 executed.                                     | **Method:** GET <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/ratings` <br> **Headers:** None                                                                                                                             | **Status:** 200 OK <br> **Body:** `AggregateRatingResponse` with `averageRating`, `totalRatingsCount`, and `currentUserRating: null`.                                                                                                             | Use `submittedVideoId`.                                                                                                                                                                |
| **CR-007**   | Get Aggregate & User Rating  | Authenticated user gets video rating summary.              | CR-005 executed.                                               | **Method:** GET <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/ratings` <br> **Headers:** `Authorization: Bearer {{viewerToken}}`                                                                                           | **Status:** 200 OK <br> **Body:** `AggregateRatingResponse` with `averageRating`, `totalRatingsCount`, and `currentUserRating: 4`.                                                                                                          | Use `submittedVideoId`.                                                                                                                                                                |

---
#### Epic 6: Content Moderation & Moderator Roles

*Prerequisite: `admin@example.com` user (`testUserIdModerator`, `moderatorToken`) needs to be assigned the "moderator" role. This is the first step (MOD-002).*

| Test Case ID | Feature/User Story                 | Test Scenario                                                      | Preconditions                                                                      | Test Steps (Postman)                                                                                                                                                                                                                             | Expected Result                                                                                                                                                                                                                           | Test Data                                                                                                                                                               |
| :----------- | :--------------------------------- | :----------------------------------------------------------------- | :--------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **MOD-001**  | Flag Content (Video)               | Authenticated "viewer" flags a video.                              | VC-001, AM-005 executed.                                                           | **Method:** POST <br> **URL:** `{{baseURL}}/flags` <br> **Headers:** `Authorization: Bearer {{viewerToken}}`, `Content-Type: application/json` <br> **Body:** `{ "contentType": "video", "contentId": "{{submittedVideoId}}", "reasonCode": "SPAM", "reasonText": "This looks like spam." }` | **Status:** 201 Created <br> **Body:** `FlagResponse` with flag details. <br> *Postman Test Script: Save `flagId` to `submittedFlagId`.*                                                                                            | `contentType`: "video", `contentId`: `{{submittedVideoId}}`, `reasonCode`: "SPAM"                                                                                         |
| **MOD-001A** | Flag Content (Video Specific Route)| Authenticated "viewer" flags a video via specific route.           | VC-001, AM-005 executed.                                                           | **Method:** POST <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/flags` <br> **Headers:** `Authorization: Bearer {{viewerToken}}`, `Content-Type: application/json` <br> **Body:** `{ "reasonCode": "INAPPROPRIATE", "reasonText": "Video content violation." }` | **Status:** 201 Created <br> **Body:** `FlagResponse`. (This creates a *second* flag on the same video).                                                                                                                     | `reasonCode`: "INAPPROPRIATE"                                                                                                                                       |
| **MOD-002**  | Assign Moderator Role              | Current "moderator" (initially admin) assigns "moderator" role to "creator" user. | AM-003, AM-007 (`moderatorToken` for admin). AM-002 (`testUserIdCreator` for creator). | **Method:** POST <br> **URL:** `{{baseURL}}/moderation/users/{{testUserIdCreator}}/assign-moderator` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`                                                                       | **Status:** 200 OK <br> **Body:** `User` object for creator, now with "moderator" in `roles`.                                                                                                                               | Target user: `testUserIdCreator`.                                                                                                                                     |
| **MOD-003**  | List Flags (Moderator)             | "Moderator" lists all open flags.                                  | MOD-001 executed. MOD-002 executed. "Creator" user logs in to get a new `creatorToken` which now has moderator rights (or reuse `moderatorToken` for admin). | **Method:** GET <br> **URL:** `{{baseURL}}/moderation/flags?status=OPEN&page=1&pageSize=10` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}` (or new token for promoted creator if they re-logged in)          | **Status:** 200 OK <br> **Body:** PaginatedResponse containing the flag from MOD-001.                                                                                                                                            | `status`: "OPEN"                                                                                                                                                      |
| **MOD-004**  | Get Flag Details (Moderator)       | "Moderator" gets details of a specific flag.                       | MOD-001, MOD-003 executed.                                                         | **Method:** GET <br> **URL:** `{{baseURL}}/moderation/flags/{{submittedFlagId}}` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`                                                                                     | **Status:** 200 OK <br> **Body:** `FlagResponse` for `submittedFlagId`.                                                                                                                                                             | Use `submittedFlagId`.                                                                                                                                                |
| **MOD-005**  | Action Flag (Moderator)            | "Moderator" approves a flag.                                       | MOD-001, MOD-003 executed.                                                         | **Method:** POST <br> **URL:** `{{baseURL}}/moderation/flags/{{submittedFlagId}}/action` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`, `Content-Type: application/json` <br> **Body:** `{ "status": "APPROVED", "moderatorNotes": "Confirmed spam." }` | **Status:** 200 OK <br> **Body:** Updated `FlagResponse` with `status: "APPROVED"`, `moderatorId`, `moderatorNotes`, `resolvedAt`. <br> *Backend console should show STUB message for content action.*                             | `status`: "APPROVED", `moderatorNotes`: "Confirmed spam."                                                                                                             |
| **MOD-005A** | Action Flag (Video Specific Route) | "Moderator" rejects a flag on a video via specific route.            | MOD-001A created a flag. MOD-003 executed. Let this flag ID be `flagIdFromMOD001A`. | **Method:** PATCH <br> **URL:** `{{baseURL}}/videos/{{submittedVideoId}}/flags/{{flagIdFromMOD001A}}` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`, `Content-Type: application/json` <br> **Body:** `{ "status": "REJECTED", "moderatorNotes": "Not a violation." }` | **Status:** 200 OK <br> **Body:** Updated `FlagResponse` with `status: "REJECTED"`.                                                                                                                                           | `status`: "REJECTED"                                                                                                                                                  |
| **MOD-006**  | Revoke Moderator Role              | "Moderator" (admin) revokes "moderator" role from "creator" user. | MOD-002 executed.                                                                  | **Method:** POST <br> **URL:** `{{baseURL}}/moderation/users/{{testUserIdCreator}}/revoke-moderator` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`                                                                      | **Status:** 200 OK <br> **Body:** `User` object for creator, "moderator" role removed from `roles`.                                                                                                                            | Target user: `testUserIdCreator`.                                                                                                                                     |
| **MOD-007**  | Search Users (Moderator)           | "Moderator" searches for users.                                    | AM-001, AM-002, AM-003 executed. MOD-003 setup done.                               | **Method:** GET <br> **URL:** `{{baseURL}}/moderation/users?search_query=Viewer` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`                                                                                       | **Status:** 200 OK <br> **Body:** List of `User` objects, including the "Test Viewer" user.                                                                                                                                     | `search_query`: "Viewer"                                                                                                                                              |
| **MOD-008**  | Restore Video (Stub)               | "Moderator" restores a video.                                      | VC-001 (video exists). MOD-003 setup done.                                         | **Method:** POST <br> **URL:** `{{baseURL}}/moderation/videos/{{submittedVideoId}}/restore` <br> **Headers:** `Authorization: Bearer {{moderatorToken}}`                                                                          | **Status:** 200 OK <br> **Body:** `ContentRestoreResponse` indicating restore initiated (stub). <br> *Backend console should show STUB message.*                                                                                        | Use `submittedVideoId`.                                                                                                                                               |

---

### 4. Notes

*   This plan is not exhaustive but covers the main functionalities of the MVP.
*   Each test case should be executed in isolation as much as possible, but some sequential dependencies exist.
*   Testers should pay attention to the Postman console for script errors and the application logs for backend STUB messages or errors.
*   The "Creator" role for the `creator@example.com` user is assigned via the `assign-moderator` endpoint (MOD-002) making them a moderator, which implicitly grants creator capabilities as per the RBAC defined. To test a pure "creator" without moderator rights, a separate user would need that role assigned, or the `assign_role_to_user` service method could be used directly in DB for test setup if an API for assigning just "creator" isn't part of MVP. For this plan, we assume a moderator performs creator actions until a dedicated "assign creator role" endpoint exists. Given the API spec, `creatorToken` is from a user who is *only* a creator. We might need to manually set a user to only have "creator" role in DB or test creator actions after a moderator promotes a user to creator, then that user logs in. For simplicity of this ATP, we assume the `moderatorToken` can perform creator actions.
*   The "Actual Result" column should be filled in during test execution.
*   Specific error messages and `ProblemDetail` structures should be verified against the API specification and implementation.

This Acceptance Test Plan should provide a good framework for verifying the KillrVideo MVP.